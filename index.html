<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flash Cards Printer</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Main Container -->
    <div class="app-container">
        <!-- Header -->
        <header>
            <h1>üìö Flash Cards Printer</h1>
            <p>Create unlimited printable flash cards</p>
        </header>

        <div class="main-content">
            <!-- Left Section: Card Creator & List -->
            <div class="left-section">
                <!-- Card Input Section -->
                <div class="card-creator">
                    <h2>Create New Card</h2>
                    
                    <div class="input-row">
                        <div class="input-field">
                            <label for="questionInput">
                                Question 
                                <span class="char-count" id="questionCharCount">0 chars</span>
                            </label>
                            <textarea id="questionInput" placeholder="Enter your question..." rows="4"></textarea>
                        </div>
                        
                        <div class="input-field">
                            <label for="answerInput">
                                Answer
                                <span class="char-count" id="answerCharCount">0 chars</span>
                            </label>
                            <textarea id="answerInput" placeholder="Enter your answer..." rows="4"></textarea>
                        </div>
                    </div>

                    <div class="creator-actions">
                        <button id="addCardBtn" class="btn btn-primary">‚ûï Add Card</button>
                        <button id="updateCardBtn" class="btn btn-success" style="display: none;">‚úì Update Card</button>
                        <button id="cancelEditBtn" class="btn btn-secondary" style="display: none;">‚úï Cancel</button>
                    </div>
                </div>

                <!-- Configuration Section -->
                <div class="config-section">
                    <label for="cardsPerSheet">Cards per sheet:</label>
                    <select id="cardsPerSheet">
                        <option value="4">4 cards (2√ó2)</option>
                        <option value="6">6 cards (2√ó3)</option>
                        <option value="8" selected>8 cards (2√ó4)</option>
                    </select>
                    <span class="card-count" id="cardCount">0 cards</span>
                </div>

                <!-- Card Collection -->
                <div class="card-collection">
                    <div class="collection-header">
                        <h2>Your Cards</h2>
                        <div class="collection-actions">
                            <button id="printAllBtn" class="btn btn-primary">üñ®Ô∏è Print All</button>
                            <button id="clearAllBtn" class="btn btn-danger">üóëÔ∏è Clear All</button>
                        </div>
                    </div>

                    <div id="cardList" class="card-list">
                        <div class="empty-state">
                            <p>No cards yet. Create your first card above! üëÜ</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Section: Grid Preview -->
            <div class="right-section">
                <div class="grid-preview">
                    <h3>üìã Layout Preview</h3>
                    <div class="sheet-tabs" id="sheetTabs">
                        <button class="sheet-tab active" data-sheet="0">Sheet 1</button>
                    </div>
                    <div class="grid-container" id="gridContainer">
                        <!-- Grid cells generated by JS -->
                    </div>
                    <div class="preview-legend">
                        <div class="legend-item">
                            <span class="legend-box empty"></span> Empty
                        </div>
                        <div class="legend-item">
                            <span class="legend-box occupied"></span> Occupied
                        </div>
                        <div class="legend-item">
                            <span class="legend-box merged"></span> Merged
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- JSON Import Section -->
        <div class="json-import-section">
            <h2>üì• Import from JSON</h2>
            <p class="import-description">Paste JSON from LLM or upload a file to bulk-create cards</p>
            
            <div class="import-methods">
                <!-- Method 1: Paste JSON -->
                <div class="import-method">
                    <label for="jsonInput">Paste JSON:</label>
                    <textarea id="jsonInput" placeholder='[{"question":"What is AI?","answer":"Artificial Intelligence"}]' rows="4"></textarea>
                    <button id="importJsonBtn" class="btn btn-primary">üì• Import JSON</button>
                </div>

                <!-- Method 2: Upload File -->
                <div class="import-method">
                    <label for="jsonFileInput">Or upload JSON file:</label>
                    <input type="file" id="jsonFileInput" accept=".json" />
                </div>
            </div>

            <!-- Format Guide (Collapsible) -->
            <details class="format-guide">
                <summary>üìñ JSON Format Guide</summary>
                <div class="format-content">
                    <p><strong>Simple format:</strong></p>
                    <pre>[
  {"question": "What is HTML?", "answer": "Markup language"},
  {"question": "What is CSS?", "answer": "Styling language"}
]</pre>
                    
                    <p><strong>With merge control (optional):</strong></p>
                    <pre>[
  {
    "question": "Long question...",
    "answer": "Long answer...",
    "mergeType": "down"
  }
]</pre>
                    <p><code>mergeType</code> can be: <code>null</code>, <code>"down"</code>, or <code>"right"</code></p>
                    
                    <p><strong>üí° LLM Prompt Template:</strong></p>
                    <pre>Generate 10 flashcards about [topic] in this exact JSON format:
[{"question":"...","answer":"..."}]</pre>
                </div>
            </details>
        </div>
    </div>

    <!-- Merge Dialog Modal -->
    <div id="mergeDialog" class="modal">
        <div class="modal-content">
            <h3>‚ö†Ô∏è Card Needs Extra Space</h3>
            <p id="mergeDialogText">This card has <strong>XXX characters</strong> and needs 2 cell positions.</p>
            
            <div class="merge-options">
                <label class="merge-option">
                    <input type="radio" name="mergeType" value="down" checked>
                    <div class="option-details">
                        <strong>Merge DOWN (recommended)</strong>
                        <span class="option-desc">Occupies 2 rows in same column</span>
                        <div class="option-visual">
                            <div class="mini-grid">
                                <div class="mini-cell active">1</div>
                                <div class="mini-cell">2</div>
                                <div class="mini-cell active">‚Üì</div>
                                <div class="mini-cell">4</div>
                            </div>
                        </div>
                    </div>
                </label>

                <label class="merge-option">
                    <input type="radio" name="mergeType" value="right">
                    <div class="option-details">
                        <strong>Merge RIGHT</strong>
                        <span class="option-desc">Occupies 2 columns in same row</span>
                        <div class="option-visual">
                            <div class="mini-grid">
                                <div class="mini-cell active">1</div>
                                <div class="mini-cell active">‚Üí</div>
                                <div class="mini-cell">3</div>
                                <div class="mini-cell">4</div>
                            </div>
                        </div>
                    </div>
                </label>

                <label class="merge-option">
                    <input type="radio" name="mergeType" value="none">
                    <div class="option-details">
                        <strong>Don't merge (shrink text)</strong>
                        <span class="option-desc">Text will be very small</span>
                    </div>
                </label>
            </div>

            <div class="modal-actions">
                <button id="cancelMergeBtn" class="btn btn-secondary">Cancel</button>
                <button id="confirmMergeBtn" class="btn btn-primary">Apply Merge</button>
            </div>
        </div>
    </div>

    <!-- Print Container (Generated Dynamically) -->
    <div class="print-container" id="printContainer"></div>

    <!-- Edit Card Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>‚úèÔ∏è Edit Flash Card</h3>
                <button class="modal-close" id="closeEditModal">‚úï</button>
            </div>

            <div class="modal-body">
                <div class="edit-card-number" id="editCardNumber">Card #1</div>
                
                <div class="input-row">
                    <!-- Question Section -->
                    <div class="input-field">
                        <label for="editQuestionInput">
                            Question
                            <span class="char-count" id="editQuestionCharCount">0 chars</span>
                        </label>
                        
                        <!-- Question Toolbar -->
                        <div class="rich-text-toolbar">
                            <button type="button" class="toolbar-btn" onclick="formatText('question', 'bold')" title="Bold (Ctrl+B)">
                                <strong>B</strong>
                            </button>
                            <button type="button" class="toolbar-btn" onclick="formatText('question', 'italic')" title="Italic (Ctrl+I)">
                                <em>I</em>
                            </button>
                            <button type="button" class="toolbar-btn" onclick="formatText('question', 'underline')" title="Underline (Ctrl+U)">
                                <u>U</u>
                            </button>
                            
                            <div class="toolbar-divider"></div>
                            
                            <button type="button" class="toolbar-btn" onclick="formatText('question', 'alignLeft')" title="Align Left">
                                ‚â°
                            </button>
                            <button type="button" class="toolbar-btn" onclick="formatText('question', 'alignCenter')" title="Align Center">
                                ‚â£
                            </button>
                            <button type="button" class="toolbar-btn" onclick="formatText('question', 'alignRight')" title="Align Right">
                                ‚â°
                            </button>
                            
                            <div class="toolbar-divider"></div>
                            
                            <button type="button" class="toolbar-btn" onclick="formatText('question', 'bulletList')" title="Bullet List">
                                ‚¶ø
                            </button>
                            <button type="button" class="toolbar-btn" onclick="formatText('question', 'numberList')" title="Numbered List">
                                ‚ìµ
                            </button>
                            
                            <div class="toolbar-divider"></div>
                            
                            <label class="toolbar-color-btn" title="Text Color">
                                üé®
                                <input type="color" id="questionColorPicker" onchange="formatText('question', 'color', this.value)" />
                            </label>
                            
                            <button type="button" class="toolbar-btn toolbar-btn-clear" onclick="clearFormatting('question')" title="Clear All Formatting">
                                ‚úï
                            </button>
                        </div>
                        
                        <textarea id="editQuestionInput" rows="5"></textarea>
                        
                        <!-- Preview -->
                        <div class="format-preview" id="questionPreview"></div>
                    </div>
                    
                    <!-- Answer Section -->
                    <div class="input-field">
                        <label for="editAnswerInput">
                            Answer
                            <span class="char-count" id="editAnswerCharCount">0 chars</span>
                        </label>
                        
                        <!-- Answer Toolbar -->
                        <div class="rich-text-toolbar">
                            <button type="button" class="toolbar-btn" onclick="formatText('answer', 'bold')" title="Bold (Ctrl+B)">
                                <strong>B</strong>
                            </button>
                            <button type="button" class="toolbar-btn" onclick="formatText('answer', 'italic')" title="Italic (Ctrl+I)">
                                <em>I</em>
                            </button>
                            <button type="button" class="toolbar-btn" onclick="formatText('answer', 'underline')" title="Underline (Ctrl+U)">
                                <u>U</u>
                            </button>
                            
                            <div class="toolbar-divider"></div>
                            
                            <button type="button" class="toolbar-btn" onclick="formatText('answer', 'alignLeft')" title="Align Left">
                                ‚â°
                            </button>
                            <button type="button" class="toolbar-btn" onclick="formatText('answer', 'alignCenter')" title="Align Center">
                                ‚â£
                            </button>
                            <button type="button" class="toolbar-btn" onclick="formatText('answer', 'alignRight')" title="Align Right">
                                ‚â°
                            </button>
                            
                            <div class="toolbar-divider"></div>
                            
                            <button type="button" class="toolbar-btn" onclick="formatText('answer', 'bulletList')" title="Bullet List">
                                ‚¶ø
                            </button>
                            <button type="button" class="toolbar-btn" onclick="formatText('answer', 'numberList')" title="Numbered List">
                                ‚ìµ
                            </button>
                            
                            <div class="toolbar-divider"></div>
                            
                            <label class="toolbar-color-btn" title="Text Color">
                                üé®
                                <input type="color" id="answerColorPicker" onchange="formatText('answer', 'color', this.value)" />
                            </label>
                            
                            <button type="button" class="toolbar-btn toolbar-btn-clear" onclick="clearFormatting('answer')" title="Clear All Formatting">
                                ‚úï
                            </button>
                        </div>
                        
                        <textarea id="editAnswerInput" rows="5"></textarea>
                        
                        <!-- Preview -->
                        <div class="format-preview" id="answerPreview"></div>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button id="saveEditBtn" class="btn btn-success">‚úì Save Changes</button>
                <button id="deleteFromEditBtn" class="btn btn-danger">üóëÔ∏è Delete Card</button>
                <button id="cancelEditModalBtn" class="btn btn-secondary">‚úï Cancel</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>